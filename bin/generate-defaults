#!/usr/bin/env python
import os
import yaml


def main():
    role_path = os.path.dirname(os.path.dirname(os.path.realpath(__file__)))
    defaults_base_file = os.path.join(role_path, 'defaults', 'main.yml.base')

    defaults_base = {}
    with open(defaults_base_file) as f:
        defaults_base = yaml.load(f.read(), Loader=yaml.SafeLoader)

    defaults = {}
    if len(defaults_base) > 0:
        for variable, config in defaults_base.items():
            if config['default'] is None and not config['templated']:
                continue
            defaults[variable] = config['default']

    defaults_file = os.path.join(role_path, 'defaults', 'main.yml')
    with open(defaults_file, 'w') as f:
        f.write(yaml.dump(defaults, explicit_start=True))


if __name__ == "__main__":
    main()
